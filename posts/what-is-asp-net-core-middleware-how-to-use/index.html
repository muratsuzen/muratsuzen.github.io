<!DOCTYPE html><html lang="en" data-mode="dark" ><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Murat Süzen" /><meta property="og:locale" content="tr_TR" /><meta name="description" content=".Net Core, Angular, T-SQL, ASP.NET Core, Typescript" /><meta property="og:description" content=".Net Core, Angular, T-SQL, ASP.NET Core, Typescript" /><link rel="canonical" href="https://muratsuzen.github.io/" /><meta property="og:url" content="https://muratsuzen.github.io/" /><meta property="og:site_name" content="Murat Süzen" /><meta property="og:type" content="website" /><link rel="next" href="https://muratsuzen.github.io/page2" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Murat Süzen" /><meta name="twitter:site" content="@muratsuezen" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebSite","description":".Net Core, Angular, T-SQL, ASP.NET Core, Typescript","headline":"Murat Süzen","name":"Murat Süzen","sameAs":["https://twitter.com/muratsuezen","https://github.com/muratsuzen"],"url":"https://muratsuzen.github.io/"}</script><title>Murat Süzen</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Murat Süzen"><meta name="application-name" content="Murat Süzen"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8591605056982916" crossorigin="anonymous"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://muratsuzen.github.io/assets/img/logo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Murat Suzen</a></div><div class="site-subtitle font-italic">software developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/muratsuzen" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/muratsuezen" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/muratsuzen/" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="https://muratsuzen.medium.com/" aria-label="medium" target="_blank" rel="noopener noreferrer"> <i class="fab fa-medium"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>What is ASP.NET Core Middleware? How to use?</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>What is ASP.NET Core Middleware? How to use?</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1704731580" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jan 8, 2024 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="745 words"> <em>4 min</em> read</span></div></div></div><div class="post-content"><p>Hello, in this article we will examine the middleware structure in ASP.NET Core. Middleware is used to perform the operations between the request and response process and to guide the process when the application runs.</p><p><a href="/assets/img/posts/netcore-middleware1.png" class="popup img-link "><img data-src="/assets/img/posts/netcore-middleware1.png" alt="Test Postman" class="lazyload" data-proofer-ignore></a> <em>Request Delegate Pipeline</em></p><p>As seen in the image above, the Middleware 1 next() method runs the next layer, Middleware 2. Middleware 2 completes its operations and Middleware 3 is executed with the next() method. When Middleware 3 completes its operations, since there is no other Middleware to run, it returns the result of the operation to Middleware 2 layer and Middleware 2 to Middleware 1 layer.</p><p>When each middleware completes its own process, it calls the next layer with the next() method and waits for a response from the next layer without finishing its own process. This spiral structure is called a pipeline. The middleware should finish processing and send a request until the entire pipeline is complete.</p><p><a href="/assets/img/posts/netcore-middleware2.png" class="popup img-link "><img data-src="/assets/img/posts/netcore-middleware2.png" alt="Test Postman" class="lazyload" data-proofer-ignore></a> <em>Middleware Pipeline</em></p><p>Let’s examine the Middleware issue by creating a sample ASP.NET Core Web API (.NET 6) project.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dotnet new webapi <span class="nt">-o</span> SampleMW
</pre></table></code></div></div><p>When we created the project, some services and middleware were added as standard in Program.cs. When we examine these codes, we can see the middleware that can be added to the runtime with the app variable added in the WebApplication type.</p><p><a href="/assets/img/posts/netcore-middleware3.png" class="popup img-link "><img data-src="/assets/img/posts/netcore-middleware3.png" alt="Test Postman" class="lazyload" data-proofer-ignore></a> <em>app intellisense</em></p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">SampleMW</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="c1">// Add services to the container.</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">();</span>
<span class="c1">// Learn more about configuring Swagger/OpenAPI at https://aka.ms/aspnetcore/swashbuckle</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddEndpointsApiExplorer</span><span class="p">();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddSwaggerGen</span><span class="p">();</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

<span class="c1">// Configure the HTTP request pipeline.</span>
<span class="k">if</span> <span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">Environment</span><span class="p">.</span><span class="nf">IsDevelopment</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseSwagger</span><span class="p">();</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseSwaggerUI</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseHttpsRedirection</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseAuthorization</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">MapControllers</span><span class="p">();</span>
<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>

</pre></table></code></div></div><p>This is how we can add middleware. We can also create our own middleware that can kick in at runtime. There are methods added so that we can run middleware that we can add in this way.</p><h2 id="usemiddleware-method"><span class="mr-2">UseMiddleware Method</span><a href="#usemiddleware-method" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Let’s create a class called CustomMiddleware. In this class, after the _next object of RequestDelegate type that we inject in the Constructor is triggered, the next middleware is called with the Invoke method when the related operations are completed.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="k">namespace</span> <span class="nn">SampleMW</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">CustomMiddleware</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">RequestDelegate</span> <span class="n">_next</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">CustomMiddleware</span><span class="p">(</span><span class="n">RequestDelegate</span> <span class="n">next</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_next</span> <span class="p">=</span> <span class="n">next</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Invoke</span><span class="p">(</span><span class="n">HttpContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//logic</span>
            <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|CustomMiddleware|"</span><span class="p">);</span>

            <span class="k">await</span> <span class="n">_next</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>app.UseMiddleware&lt;CustomMiddleware&gt;<span class="o">()</span><span class="p">;</span>
</pre></table></code></div></div><h2 id="use-method"><span class="mr-2">Use Method</span><a href="#use-method" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When the operations are completed, it calls the next middleware. When the processes of the next middleware are completed, the process continues.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="n">app</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">next</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|USE|"</span><span class="p">);</span>
    <span class="k">await</span> <span class="n">next</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">();</span>
    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|USE-RETURN|"</span><span class="p">);</span>
<span class="p">});</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">next</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|USE-NEXT|"</span><span class="p">);</span>
    <span class="k">await</span> <span class="n">next</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">();</span>
<span class="p">});</span>
</pre></table></code></div></div><p><a href="/assets/img/posts/netcore-middleware4.png" class="popup img-link "><img data-src="/assets/img/posts/netcore-middleware4.png" alt="Test Postman" class="lazyload" data-proofer-ignore></a> <em>Use Result</em></p><h2 id="run-method"><span class="mr-2">Run Method</span><a href="#run-method" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>It prevents the next intermediate layer from working. In this case, the pipeline will be terminated. This interruption is called a short circuit. Let’s add the Run method to the above code block and run it.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="n">app</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">next</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|USE|"</span><span class="p">);</span>
    <span class="k">await</span> <span class="n">next</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">();</span>
    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|USE-RETURN|"</span><span class="p">);</span>
<span class="p">});</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="k">async</span> <span class="n">c</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">c</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|RUN|"</span><span class="p">);</span>
<span class="p">});</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">next</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|USE-NEXT|"</span><span class="p">);</span>
    <span class="k">await</span> <span class="n">next</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">();</span>
<span class="p">});</span>
</pre></table></code></div></div><p><a href="/assets/img/posts/netcore-middleware5.png" class="popup img-link "><img data-src="/assets/img/posts/netcore-middleware5.png" alt="Test Postman" class="lazyload" data-proofer-ignore></a> <em>Run Result</em></p><p>As you can see, the return was made without running the Use method containing the Use-Next text.</p><h2 id="map-method"><span class="mr-2">Map Method</span><a href="#map-method" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We use it when we want to run different middleware by filtering according to the path of the request from the client.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="n">app</span><span class="p">.</span><span class="nf">Map</span><span class="p">(</span><span class="s">"/weatherforecast"</span><span class="p">,</span> <span class="n">builder</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="k">async</span> <span class="n">x</span><span class="p">=&gt;</span> <span class="k">await</span> <span class="n">x</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|RUN MAP - WEATHERFORECAST|"</span><span class="p">));</span>
<span class="p">});</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Map</span><span class="p">(</span><span class="s">"/home"</span><span class="p">,</span> <span class="n">builder</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">next</span><span class="p">)</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|USE MAP - HOME|"</span><span class="p">);</span>
        <span class="k">await</span> <span class="n">next</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">();</span>
        <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|USE MAP RETURN - HOME|"</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></table></code></div></div><p><a href="/assets/img/posts/netcore-middleware6.png" class="popup img-link "><img data-src="/assets/img/posts/netcore-middleware6.png" alt="Getweatherforecast" class="lazyload" data-proofer-ignore></a> <em>Get /weatherforecast</em></p><p><a href="/assets/img/posts/netcore-middleware6.png" class="popup img-link "><img data-src="/assets/img/posts/netcore-middleware6.png" alt="Gethome" class="lazyload" data-proofer-ignore></a> <em>Get /home</em></p><h2 id="mapwhen-method"><span class="mr-2">MapWhen Method</span><a href="#mapwhen-method" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>With the MapWhen method, filtering can be done according to any feature of the request from the client.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">app</span><span class="p">.</span><span class="nf">MapWhen</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Path</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"/home"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">x</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Method</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"GET"</span><span class="p">),</span> <span class="n">builder</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="k">async</span> <span class="n">x</span> <span class="p">=&gt;</span> <span class="k">await</span> <span class="n">x</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|RUN MAPWHEN - HOME|"</span><span class="p">));</span>
<span class="p">});</span>   <span class="n">app</span><span class="p">.</span><span class="nf">MapWhen</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Path</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"/home"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">x</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Method</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"GET"</span><span class="p">),</span> <span class="n">builder</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="k">async</span> <span class="n">x</span> <span class="p">=&gt;</span> <span class="k">await</span> <span class="n">x</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|RUN MAPWHEN - HOME|"</span><span class="p">));</span>
<span class="p">});</span><span class="n">app</span><span class="p">.</span><span class="nf">MapWhen</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Path</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"/home"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">x</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Method</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"GET"</span><span class="p">),</span> <span class="n">builder</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">builder</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="k">async</span> <span class="n">x</span> <span class="p">=&gt;</span> <span class="k">await</span> <span class="n">x</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="s">"|RUN MAPWHEN - HOME|"</span><span class="p">));</span>
<span class="p">});</span>
</pre></table></code></div></div><p><a href="/assets/img/posts/netcore-middleware7.png" class="popup img-link "><img data-src="/assets/img/posts/netcore-middleware7.png" alt="Gethome" class="lazyload" data-proofer-ignore></a> <em>Get /home</em></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/asp-net-core/'>ASP.NET CORE</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/asp-net-core/" class="post-tag no-text-decoration" >asp.net core</a> <a href="/tags/web-api/" class="post-tag no-text-decoration" >web api</a> <a href="/tags/middleware/" class="post-tag no-text-decoration" >middleware</a> <a href="/tags/net-6-0/" class="post-tag no-text-decoration" >net 6.0</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=What%20is%20ASP.NET%20Core%20Middleware?%20How%20to%20use?%20-%20Murat%20Suzen&url=https%3A%2F%2Fmuratsuzen.github.io%2Fposts%2Fwhat-is-asp-net-core-middleware-how-to-use%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=What%20is%20ASP.NET%20Core%20Middleware?%20How%20to%20use?%20-%20Murat%20Suzen&u=https%3A%2F%2Fmuratsuzen.github.io%2Fposts%2Fwhat-is-asp-net-core-middleware-how-to-use%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmuratsuzen.github.io%2Fposts%2Fwhat-is-asp-net-core-middleware-how-to-use%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/asp-net-core/">asp.net core</a> <a class="post-tag" href="/tags/web-api/">web api</a> <a class="post-tag" href="/tags/dotnet/">dotnet</a> <a class="post-tag" href="/tags/net-6-0/">net 6.0</a> <a class="post-tag" href="/tags/csharp/">csharp</a> <a class="post-tag" href="/tags/middleware/">middleware</a> <a class="post-tag" href="/tags/net-9/">.NET 9</a> <a class="post-tag" href="/tags/api-key/">api key</a> <a class="post-tag" href="/tags/aspnet-core/">aspnet core</a> <a class="post-tag" href="/tags/dependency-injection/">dependency injection</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/using-api-key-authorization-with-middleware-and-attribute-on-asp-net-core-web-api/"><div class="card-body"> <em class="small" data-ts="1704731580" data-df="ll" > Jan 8, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using API Key Authorization with Middleware and Attribute on ASP.NET Core Web API</h3><div class="text-muted small"><p> Hello, in this article, we will API Key authorization on ASP.NET Core Web API with middleware and attribute. We will create an ASP.NET Core Web API project named ApiKeyAuthentication. Using Middle...</p></div></div></a></div><div class="card"> <a href="/posts/adding-multiple-languages-with-asp-net-core-mvc/"><div class="card-body"> <em class="small" data-ts="1704796380" data-df="ll" > Jan 9, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Adding Multiple Languages ​​with ASP.NET Core MVC</h3><div class="text-muted small"><p> Hello, in this article we will examine how we can add multiple language support to ASP.NET Core MVC application. First of all, since we will keep the language definitions in resource files, we will...</p></div></div></a></div><div class="card"> <a href="/posts/asp-net-core-http-security-header/"><div class="card-body"> <em class="small" data-ts="1704796380" data-df="ll" > Jan 9, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ASP.NET Core Http Security Header</h3><div class="text-muted small"><p> Let’s examine how the Http Security Header structure is used on .NET Core in a sample ASP.NET Core project. First we will create a blank web project. 1 dotnet new web -o httpsecurityheader After...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/using-api-key-authorization-with-middleware-and-attribute-on-asp-net-core-web-api/" class="btn btn-outline-primary" prompt="Older"><p>Using API Key Authorization with Middleware and Attribute on ASP.NET Core Web API</p></a> <a href="/posts/adding-multiple-languages-with-asp-net-core-mvc/" class="btn btn-outline-primary" prompt="Newer"><p>Adding Multiple Languages ​​with ASP.NET Core MVC</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "muratsuzen/muratsuzen.github.io", "data-repo-id": "R_kgDOHzYwFw", "data-category": "General", "data-category-id": "DIC_kwDOHzYwF84CQwaD", "data-mapping": "og:title", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "top", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/asp-net-core/">asp.net core</a> <a class="post-tag" href="/tags/web-api/">web api</a> <a class="post-tag" href="/tags/dotnet/">dotnet</a> <a class="post-tag" href="/tags/net-6-0/">net 6.0</a> <a class="post-tag" href="/tags/csharp/">csharp</a> <a class="post-tag" href="/tags/middleware/">middleware</a> <a class="post-tag" href="/tags/net-9/">.NET 9</a> <a class="post-tag" href="/tags/api-key/">api key</a> <a class="post-tag" href="/tags/aspnet-core/">aspnet core</a> <a class="post-tag" href="/tags/dependency-injection/">dependency injection</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/muratsuzen">Murat Suzen</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> (function () { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE ? "dark" : "default"); let config = {theme: expectedTheme}; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function () { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Create mermaid tag */ $("pre").has("code.language-mermaid").each(function () { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); })(); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { /* start/end delimiter pairs for in-line math */ inlineMath: [ ['$', '$'], ['\\(', '\\)'] ], /* start/end delimiter pairs for display math */ displayMath: [ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B206HX7D04"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-B206HX7D04'); }); </script>
